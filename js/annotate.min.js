function initDraw(e){function t(e){var t=e||window.event;t.pageX?(a.x=t.pageX,a.y=t.pageY):t.clientX&&(a.x=t.clientX+document.body.scrollLeft,a.y=t.clientY+document.body.scrollTop)}var a={x:0,y:0,startX:0,startY:0},r=null;"true"===localStorage.getItem("draw")&&(e.onmousemove=function(e){t(e),null!==r&&(r.style.width=Math.abs(a.x-a.startX)+"px",r.style.height=Math.abs(a.y-a.startY)+"px",r.style.left=a.x-a.startX<0?a.x+"px":a.startX+"px",r.style.top=a.y-a.startY<0?a.y+"px":a.startY+"px")},e.onclick=function(t){return null===r?(t.preventDefault(),a.startX=a.x,a.startY=a.y,r=document.createElement("div"),r.className="rectangle",r.style.left=a.x+"px",r.style.top=a.y+"px",$(r).css("border-color",localStorage.getItem("box_color")),$(r).css("border-width",localStorage.getItem("box_width")+"px"),""!==localStorage.getItem("box_bg_color")&&$("<div />").css({width:"100%",height:"100%",display:"block","background-color":localStorage.getItem("box_bg_color"),opacity:".2"}).appendTo(r),e.appendChild(r),$(r).draggable(),$(r).resizable({containment:"parent",handles:"n, e, s, w, ne, nw, se, sw",resize:function(e,t){stop_drawing_boxes(document.getElementById("marker_body_wrap")),$("#place_marker").find("img").attr("src",chrome.extension.getURL("images/pins/pin_24_inactive.png")),localStorage.setItem("marker_place_flag","false"),$("#marker-pin-colors-drawer").remove(),unplace_marker()},stop:function(e,t){initDraw(document.getElementById("marker_body_wrap"))}}),!1):(r=null,$("#marker_draws").click(),$(".rectangle").bind("contextmenu",function(e){e.preventDefault(),$(this).remove()}),void 0)})}function stop_drawing_boxes(e){e.onmousemove=function(e){},e.onclick=function(e){},$("#marker-box-colors-drawer").slideUp("fast"),$("#marker_body_wrap").css("cursor","")}function draw_select_color_options(){if($("#marker-box-colors-drawer").length>0)$("#marker-box-colors-drawer").slideDown("slow");else{var e=$("<div />").attr("id","marker-box-colors-drawer").appendTo("#marker-control-panel");$("<strong />").addClass("marker").text("Change box width").appendTo(e);var t=$("<div />").css({margin:"10px"}).appendTo(e),a=($("<a />").attr({id:"marker_sub_box_change"}).addClass("change_width marker_anchor").html('<img src="'+chrome.extension.getURL("images/minus.png")+'" alt="Reduce border width by 1px" />').appendTo(t),$("<input />").attr({type:"text","class":"marker_box_width_select",value:localStorage.getItem("box_width")}).bind("mousewheel",function(e){e.preventDefault(),e.originalEvent.wheelDelta/120>0?(localStorage.setItem("box_width",parseInt($(this).val())+1),$(this).val(parseInt($(this).val())+1)):(localStorage.setItem("box_width",$(this).val()-1),$(this).val($(this).val()-1))}).appendTo(t),$("<a />").attr({id:"marker_add_box_change"}).addClass("change_width marker_anchor").html('<img src="'+chrome.extension.getURL("images/plus.png")+'" alt="Increase border width by 1px" />').appendTo(t),document.createElement("INPUT"));$(a).attr("type","text"),$(a).attr("id","marker_color_select").attr("style","z-index: 2147483635").addClass("jscolor").val(localStorage.getItem("box_color").substring(1,localStorage.getItem("box_color").length));var r=new jscolor(a),o=document.createElement("INPUT");$(o).attr("type","text"),$(o).attr("id","marker_bg_color_select").attr("style","z-index: 2147483635").addClass("jscolor").val(localStorage.getItem("box_bg_color").substring(1,localStorage.getItem("box_bg_color").length));var n=new jscolor(o);$(".change_width").click(function(){var e=$(".marker_box_width_select").val();"marker_sub_box_change"===$(this).attr("id")?e-=1:e=parseInt(e)+1,$(".marker_box_width_select").val(e),localStorage.setItem("box_width",e),sendUpdate()});var s=$("<label />").css({"font-weight":"bold","border-bottom":"solid 1px #aaa","margin-bottom":"5px","padding-left":"5px",display:"block"}).attr("for","marker_color_select").addClass("marker").text("Box color").css("width","97%"),i=$("<label />").css({"font-weight":"bold","border-bottom":"solid 1px #aaa","margin-bottom":"5px","padding-left":"5px",display:"block"}).attr("for","marker_bg_color_select").addClass("marker").text("Box background color").css("width","97%");$(n).ready(function(){var t=$("<div />");$(o).appendTo(t),$(i).prependTo(t),$(t).appendTo(e)}),$(r).ready(function(){var t=$("<div />");$(a).appendTo(t),$(s).prependTo(t),$(t).appendTo(e)}),$("#marker_color_select").change(function(){localStorage.setItem("box_color","#"+$("#marker_color_select").val()),sendUpdate()}).appendTo(e),$(o).change(function(){localStorage.setItem("box_bg_color","#"+$(o).val()),sendUpdate()}),$(".marker_anchor").attr("href","javascript:(0);"),$(e).slideDown("slow")}}function draw_highlight_color_options(){$("#marker-pin-colors-drawer").remove();var e=$("<div />").attr("id","marker-pin-colors-drawer").appendTo("#marker-control-panel");$("<strong />").addClass("marker").text("Change box color").appendTo(e);var t=document.createElement("INPUT");$(t).attr("type","text"),$(t).attr("id","marker_color_select").addClass("jscolor").val(localStorage.getItem("highlight_color").substring(1,localStorage.getItem("highlight_color").length)).appendTo(e);new jscolor(t);$("#marker_color_select").change(function(){localStorage.setItem("highlight_color","#"+$("#marker_color_select").val())}).appendTo(e)}function createContextMenu(e,t,a){var r,o="marker_context_menu"+$(e).attr("data-marker-count"),n=$(e).css("top"),s=$(window).width();if(0===$("#"+o).length){r=t.pageX+427>s?s-450+"px":t.pageX+35+"px";var i=$("<div />").addClass("marker_context_menu").css({left:r,top:n}).attr("role","dialog").attr("id",o).attr("data-marker-dialog-count",$(e).attr("data-marker-count")).draggable({stop:function(){}}).css("position","absolute").appendTo("body");$("<a />").attr({"class":"marker_context_close",href:"javascript:void(0)"}).html('<span class="screen-reader-only">Close context menu for number'+$(e).attr("data-marker-count")+'</span><img src="'+chrome.extension.getURL("images/close.png")+'" alt="" />').click(function(t){hideMenu("marker_context_menu"+$(e).attr("data-marker-count"))}).appendTo(i);$("<h2 />").addClass("marker marker_drag").attr("tabindex","-1").text("Add notes").appendTo(i);var l=$("<div />").addClass("marker-context-menu-iframe-container").appendTo(i),c=($("<iframe />").css("display","none").addClass("marker-context-iframe").attr("id","marker-context-menu-"+$(e).attr("data-marker-count")).appendTo(l),$("#marker-context-menu-"+$(e).attr("data-marker-count"))[0].contentWindow.document),d=$(c).find("body");append_scripts_to_head("",$(c).find("head"));var p=$("<div />").addClass("marker marker_info").appendTo(d);if("a11y"===localStorage.getItem("set")||"html"===localStorage.getItem("set"))$("<label />").attr("for","marker_select_box_"+mCount).addClass("marker_required marker_label").text("Type of element?").appendTo(p),add_marker_select_options(p,e,a),$("<label />").attr("for","marker_textarea_"+mCount).addClass("marker_required marker_label").text("Notes").appendTo(p),$("<textarea />").addClass("marker_textarea_notes").attr("id","marker_textarea)"+mCount).appendTo(p),$(".marker-context-menu-iframe-container:visible").css("height","390px");else{$("<label />").attr("for","marker_textarea_"+mCount).addClass("marker_required marker_label").text("Notes").appendTo(p),$("<textarea />").addClass("marker_textarea_notes").attr("id","marker_textarea)"+mCount).appendTo(p);$(p).height();$(".marker-context-menu-iframe-container:visible").css("height","305px"),$(".marker_context_menu:visible").css("height","335px")}$("<button />").addClass("marker marker_fun_btn marker_save_note_btn").attr("value","Save Note").text("Save").click(function(t){hideMenu("marker_context_menu"+$(e).attr("data-marker-count"))}).appendTo(d),$("<button />").addClass("marker marker_fun_btn").attr("value","Delete").text("Delete this flag").click(function(t){$(e).remove(),$(mifBody).find(".marker_side_text_selection").eq($(mifBody).find(".marker_side_text_selection").length-1).remove(),$(i).remove(),mCount--}).appendTo(d),$("#"+o).find("iframe").ready(function(){$("#"+o).find("iframe").fadeIn("fast")})}else showMenu(o,a)}function add_marker_select_options(e,t,a){var r=getOptions(),o=$("<select />").attr("id","marker_select_box_"+mCount).attr("aria-required","true").appendTo(e),n=$("<div />").addClass("marker marker_recommendation").attr("id","marker_select_text_div_"+mCount).appendTo(e),s=$("<a />").addClass("marker-a11y-rec-a marker_anchor").attr("aria-expanded","true").click(function(e){"false"===$(this).attr("aria-expanded")?($(this).parent().find(".marker_recommendation_div").show(),$(this).attr("aria-expanded","true")):($(this).parent().find(".marker_recommendation_div").hide(),$(this).find(".marker-a11y-rec-note").text("[ collapsed ]"),$(this).attr("aria-expanded","false"))}).appendTo(n),i=$("<strong />").addClass("recommendations").text("Recommendation").css("display","none").appendTo(s);$("<span />").addClass("marker-a11y-rec-note").appendTo(i);$(r).each(function(e,t){$("<option />").attr("value",t.Value).attr("data-marker-rec",t.Recommendation).attr("data-marker-example",t.Example).text(t.QuickName).appendTo(o)}),$(o).change(function(){var t=$(this).val();""===t?$(i).hide():$(this).find("option").each(function(e,a){if(t===$(a).attr("value")){var r=$("<div />").addClass("marker marker_recommendation_div").html($(a).attr("data-marker-rec")),o=$("<div />").addClass("marker marker_recommendation_div").text($(a).attr("data-marker-example"));$(i).show(),$(n).show(),$(this).parent(0).parent().parent().find(".marker_ele_type").text($(a).text()),$(this).parent().parent().find(".marker_recommendation_div, .marker-rec-ex").remove(),$(this).parent().parent().find(".marker_recommendation").append(r);var n=$("<strong />").addClass("recommendations marker-rec-ex").text("Example");return $(this).parent().parent().find(".marker_recommendation").append(n),$(this).parent().parent().find(".marker_recommendation").append(o),!1}});var a=$(e).height(),r=a+95;$(".marker-context-menu-iframe-container:visible").css("height",r+"px"),$(".marker_context_menu:visible").css("height",r+"px")});t.nodeName,$(t).text();a&&($(o).val(a),$(o).change())}function append_scripts_to_head(e,t){var a=$("<link />").attr({rel:"stylesheet",type:"text/css",href:chrome.extension.getURL("css/railway.css")}),r=$("<link />").attr({rel:"stylesheet",type:"text/css",href:"https://fonts.googleapis.com/css?family=Ubuntu"}),o=$("<link />").attr({rel:"stylesheet",type:"text/css",href:chrome.extension.getURL("css/marker.css")});e&&$(a,r,o).appendTo(e),t&&($(o).appendTo(t),$(a).appendTo(t),$(r).appendTo(t))}function create_iframe(e,t,a){var r=$("<iframe />").attr({id:e}).appendTo(t);return a&&$(r).addClass(a),r}function get_iframe_bod(e){var t=$("#"+e)[0].contentWindow.document,a=$(t).find("body");return a}function get_iframe_head(e){var t=$("#"+e)[0].contentWindow.document,a=$(t).find("head");return a}function hideMenu(e){$("#"+e).fadeOut("1000")}function showMenu(e,t){$("#"+e).fadeIn("fast"),t&&$("#"+e).find("select").val(t)}function getOptions(){return"a11y"!==localStorage.getItem("set")||localStorage.getItem("preset")?options=$.parseJSON(localStorage.getItem("preset")):$.ajax({url:chrome.extension.getURL("js/types.json"),dataType:"text",type:"GET",async:!1,crossDomain:!1,success:function(e){options=$.parseJSON(e)}}),options}function get_select_options(){$.ajax({url:chrome.extension.getURL("js/types.json"),dataType:"text",type:"GET",async:!1,crossDomain:!1,success:function(e){localStorage.setItem("preset",e)}})}function update_page_json(){for(var e in pageJson)pageJson[e][sess_id]&&(pageJson[e][sess_id]=[]);$(".rectangle").each(function(e,t){var a={type:"box",left:$(t).offset().left,top:$(t).offset().top,width:$(t).width(),height:$(t).height(),box_color:$(t).css("border-color"),box_width:$(t).css("border-width"),box_bg_color:$(t).find("div").eq(0).css("background-color")};update_marker_page_obj(a)}),$("a.marker_page_marker").each(function(e,t){var a={type:"pin",left:$(t).css("left"),top:$(t).css("top"),pin_size:$(t).attr("data-marker_pin_size"),"flag-color":$(t).attr("data_marker_flag_color"),"data-marker-count":$(t).attr("data-marker-count")};update_marker_page_obj(a)}),$("textarea.marker_text_note_marker_textarea").each(function(e,t){var a={type:"text",left:$(t).parent().css("left"),top:$(t).parent().css("top"),text:$(t).val(),color:$(t).css("color"),background:$(t).css("background-color"),border_w:$(t).parent().css("border-width"),border_c:$(t).parent().css("border-color"),width:$(t).parent().css("width"),height:$(t).parent().css("height"),font:$(t).css("font-size"),shadow:$(t).css("text-shadow")};update_marker_page_obj(a)}),localStorage.setItem("pageJson",JSON.stringify(pageJson)),sendUpdate()}function update_marker_page_obj(e){var t=Math.max(document.documentElement.clientWidth,window.innerWidth||0),a=Math.max(document.documentElement.clientHeight,window.innerHeight||0);e.win_w=t,e.win_h=a;for(var r in pageJson){pageJson[r][window.location.href];pageJson[r][sess_id]&&pageJson[r][sess_id].push(e)}}function get_page_json(){pageJson=$.parseJSON(localStorage.getItem("pageJson")),pageJson||(pageJson=[]);var e=window.location.href,t=Date.now();sess_id=t;var a={};a[t]=[],a.url=e,a.date_time=timeStamp(),a.val=t,pageJson.push(a)}function timeStamp(){var e=new Date,t=[e.getMonth()+1,e.getDate(),e.getFullYear()],a=[e.getHours(),e.getMinutes(),e.getSeconds()],r=a[0]<12?"AM":"PM";a[0]=a[0]<12?a[0]:a[0]-12,a[0]=a[0]||12;for(var o=1;3>o;o++)a[o]<10&&(a[o]="0"+a[o]);return t.join("/")+" "+a.join(":")+" "+r}function returnDate(e){var t=e.split("/"),a="";switch(t[0]){case"1":a+="January ";break;case"2":a+="February ";break;case"3":a+="March ";break;case"4":a+="April ";break;case"5":a+="May ";break;case"6":a+="June ";break;case"7":a+="July ";break;case"8":a+="August ";break;case"9":a+="September ";break;case"10":a+="October ";break;case"11":a+="November ";break;case"12":a+="December "}return a+=t[1]+", "+t[2]}function display_previous_annotations(e){console.log(e),$(".rectangle, .marker_page_marker, .marker_text_note_marker").remove();var t=e.val;$(e[t]).each(function(e,t){var a=t.type;switch(a){case"box":var r=$('<div class="rectangle" />').css({"border-width":t.box_width,"border-color":t.box_color,width:t.width,height:t.height,position:"absolute",left:t.left,top:t.top}).appendTo("#marker_body_wrap");$("<div />").css({"background-color":t.box_bg_color,opacity:".3",width:"100%",height:"100%"}).appendTo(r);$(r).draggable(),$(r).resizable({containment:"parent",handles:"n, e, s, w, ne, nw, se, sw",resize:function(e,t){stop_drawing_boxes(document.getElementById("marker_body_wrap")),$("#place_marker").find("img").attr("src",chrome.extension.getURL("images/pins/pin_24_inactive.png")),localStorage.setItem("marker_place_flag","false"),$("#marker-pin-colors-drawer").remove(),unplace_marker()},stop:function(e,t){initDraw(document.getElementById("marker_body_wrap"))}}),$(".rectangle").bind("contextmenu",function(e){e.preventDefault(),$(this).remove()});break;case"pin":var o=$("<a />").addClass("marker_page_marker marker_anchor").attr({"data-marker-count":t["data-marker-count"],href:"javascript:void(0);"}).css({position:"absolute",top:t.top,left:t.left}).appendTo("#marker_body_wrap"),n=$("<img />").attr({src:chrome.extension.getURL("images/pins/pin_24_"+t["flag-color"]+".png"),alt:t["flag-color"]+" pin"}).css({width:t.pin_size}).appendTo(o);break;case"text":var r=$("<div />").addClass("marker_text_note_marker").attr("id","marker_text_note_"+nCount).css({position:"absolute",top:t.top,left:t.left,width:t.width,height:t.height,"border-color":t.border_c,"border-width":t.border_w}).resizable({handles:"n, e, s, w, ne, nw, se, sw",containment:"parent",resize:function(){$(r).find("textarea").css("width",$(r).width()-10+"px")},stop:function(){}}).draggable({containment:"parent"}).attr({id:"marker_text_note_"+nCount,"class":"marker_text_note_marker",tabinex:"-1"}).draggable({containment:"parent"}).appendTo("#marker_body_wrap"),s=localStorage.getItem("text_background"),i=.01*parseInt(localStorage.getItem("text_bg_opacity"));$("<div />").css({opacity:i,"background-color":s,display:"block",width:"100%",height:"100%",border:"solid 1px #"+t.border_c}).addClass("marker_bg_opaque").appendTo(r);var l,c=$("<textarea />").css({"background-color":t.background,color:t.color,width:"99%",height:"100%","font-size":t.font,"text-shadow":t.shadow}).attr("id","marker_text_note_textarea_"+nCount).addClass("marker_text_note_marker_textarea").val(t.text).appendTo(r);$(r).hover(function(){l=setTimeout(function(){$(r).find("img").fadeIn("slow"),draw_textbox_options(c,nCount-1)},500)},function(){clearTimeout(l),$(r).find("img").fadeOut("slow"),remove_textbox_options(c,nCount-1)}),$(c).bind("mousewheel",function(e){if(e.preventDefault(),e.originalEvent.wheelDelta/120>0){var t=parseInt($(this).css("font-size").split("p")[0]);t+=1,$(this).css("font-size",t+"px")}else{var t=$(this).css("font-size").split("p")[0];t-=1,$(this).css("font-size",t+"px")}});var n=$("<img />").attr("src",chrome.extension.getURL("images/notes.png")).attr("title","Right click to delete").attr("alt","Note "+nCount).css({position:"absolute",width:"24px",left:"-26px",display:"none"}).bind("contextmenu",function(e){e.preventDefault(),$(r).remove()}).prependTo(r);$(n).hover(function(){return!1}),nCount++}})}function display_previous(){var e=window.location.href;for(var t in pageJson)if(pageJson[t].url===e){var a=pageJson[t].val,r=pageJson[t][a].length;if(r>0){$(".marker-panel-heading").prepend('<a href="javascript:void(0);"><img id="ann-alarm" style="padding-right: 5px; vertical-align: baseline; width: 20px;" src="'+chrome.extension.getURL("images/alarm.png")+'" title="You have previous markings on this page!" /></a>');var o=$("#ann-alarm").parent();$(o).click(function(){0===$(".ann-prev-list-cont").length?show_previous_dialog():$(".ann-prev-list-cont").remove()});break}}}function show_previous_dialog(){var e=$("<div />").addClass("ann-prev-list-cont").appendTo(".marker-panel-heading");$(pageJson).each(function(t,a){var r=a.val;if(a[r].length>0&&a.url===window.location.href){var o=$("<div />").addClass("ann-prev-list-item").appendTo(e),n=$("<a />").attr("href","javascript:void(0);").attr("data-ann-val",r).html(returnDate(a.date_time)+'<br /><span class="small">'+a[r].length+" annotations</span>").appendTo(o),s=a;$(n).click(function(e){$(".ann-prev-list-cont").remove(),display_previous_annotations(s)})}}),$("#marker_body_wrap").click(function(){$(".ann-prev-list-cont").remove()})}function highlightSelection(){var e=window.getSelection();if(e.rangeCount>0){$("#marker_highlight").find("img").attr("src",chrome.extension.getURL("images/highlight_24.png")),setTimeout(function(){$("#marker_highlight").find("img").attr("src",chrome.extension.getURL("images/highlight_24_inactive.png"))},2e3);var t=e.getRangeAt(0);$(t.commonAncestorContainer).wrap('<span class="marker-highlight-text" style="display:block; background-color: '+localStorage.getItem("highlight_color")+';" />')}else console.log("Marker [Nothing to highlight]")}function place_marker(){$("#marker_body_wrap, #marker_body_wrap a, #marker_body_wrap button").bind("click",function(e){e.preventDefault(),e.stopPropagation();var t,a,r=parseInt(localStorage.getItem("pin_size").split("p")[0]),o=JSON.parse(localStorage.getItem("pin_array_icons")),n=localStorage.getItem("flag-color").toLowerCase();for(var s in o){if(o[s].toLowerCase()===n){a=r-4,t=r-4;break}var i=.839*r;a=r-i;var i=.55*r;t=r-i}console.log("l_diff: "+t+", e.pageX: "+e.pageX),console.log("t_diff "+a+", e.pageY: "+e.pageY),console.log("Icon size: "+r);var l=e.pageX-t,c=e.pageY-a;return place_ind_marker(l,c),!1}),$("<div />").attr({id:"marker_pin_mouse_position_div","class":"marker",style:"display: none;"}).appendTo("body"),$(document).bind("mouseover",function(e){$("#marker_pin_mouse_position_div").show().html('<span class="marker-pos-x">Axis X: '+e.pageX+'</span><span class="marker-pos-y">Axis Y:'+e.pageY+"</span>")})}function place_ind_marker(e,t,a){var r=$("<a />").addClass("marker_page_marker marker_anchor").css({position:"absolute",left:e+"px",top:t+"px"}).bind("contextmenu",function(e){e.preventDefault(),createContextMenu($(this),e,a)}).click(function(e){return"true"===localStorage.getItem("leftclick")&&(createContextMenu($(this),e,a),e.preventDefault()),!1}).attr({"data-marker-count":mCount,"data-marker_pin_size":localStorage.getItem("pin_size"),data_marker_flag_color:localStorage.getItem("flag-color")}).appendTo("#marker_body_wrap").draggable({stop:function(){hideMenu("marker_context_menu"+$(this).attr("data-marker-count"))}});$("<img />").attr({src:chrome.extension.getURL("images/pins/pin_24_"+localStorage.getItem("flag-color")+".png"),"class":"marker_page_marker",style:"width: "+localStorage.getItem("pin_size")+";","data-marker-count":mCount}).attr("alt","Marker "+mCount).appendTo(r),"48px"===localStorage.getItem("pin_size")&&$("a.marker_page_marker").css("width","85px"),"true"===localStorage.getItem("rotate_marker")&&$(r).find("img").addClass("marker_page_marker_rotate"),mCount++}function unplace_marker(){$("#marker-pin-colors-drawer").slideUp("fast"),localStorage.setItem("marker_place_flag","false"),localStorage.setItem("rotate_marker","false"),$("#marker_body_wrap, #marker_body_wrap a, #marker_body_wrap button").unbind("click"),$("#marker_pin_mouse_position_div").remove()}function draw_new_marker_options(){if($("#marker-pin-colors-drawer").length>0)$("#marker-pin-colors-drawer").slideDown("slow");else{var e=$("<div />").attr("id","marker-pin-colors-drawer").appendTo("#marker-control-panel"),t=(create_iframe("marker-pin-colors-iframe",e),get_iframe_bod("marker-pin-colors-iframe")),a=get_iframe_head("marker-pin-colors-iframe");append_scripts_to_head("",a),$("<strong />").addClass("marker").text("Select new pin").appendTo(t);var r=JSON.parse(localStorage.getItem("default_icons"));if($(r).each(function(e,a){$("<a />").attr("data-val",a.toLowerCase()).addClass("marker_option marker_anchor").html('<img src="'+chrome.extension.getURL("images/pins/pin_24_"+a.toLowerCase()+".png")+'" alt="'+a+' marker" />').appendTo(t)}),"true"===localStorage.getItem("pack_1")){var o=JSON.parse(localStorage.getItem("fun_icons"));$(o).each(function(e,a){$("<a />").attr("data-val",a.toLowerCase()).addClass("marker_option marker_anchor").html('<img src="'+chrome.extension.getURL("images/pins/pin_24_"+a.toLowerCase()+".png")+'" alt="'+a+' marker" />').appendTo(t)})}else $("#marker-pin-colors-iframe").css("height","275px");draw_pin_options(t),$(t).find(".marker_option img").css("width","24px"),$(t).find(".marker_option img").each(function(e,t){$(t).attr("title",$(t).attr("alt"))}),$(t).find(".marker_option").click(function(){localStorage.setItem("flag-color",$(this).attr("data-val")),$("#place_marker").find("img").css("width","24px").attr("src",chrome.extension.getURL("images/pins/pin_24_"+localStorage.getItem("flag-color")+".png"))}),$(t).find("a").attr("href","javascript:void(0);"),$(e).slideDown("slow")}}function draw_pin_options(e){var t=localStorage.getItem("pin_size").split("p")[0],a=$("<strong />").addClass("marker").css({"border-top":"solid 1px #ccc","padding-top":"5px","padding-bottom":"5px"}).appendTo(e),r=$("<div />").css("display","none").appendTo(e);$("<a />").css({color:"#000","font-weight":"bold","text-decoration":"underline","font-size":"12px",display:"block","margin-top":"-15px","border-bottom":"solid 1px #ccc",padding:"8px"}).addClass("default_options_a marker").text("Change default options").click(function(){var e=chrome.extension.getURL("index.html");window.open(e)});var o=($("<label />").attr({"for":"marker_size_option","class":"ubuntu marker_options_edit",style:"margin-left: 10px;"}).text("Pin size (pixels)").appendTo(r),$("<a />").attr({id:"marker_sub_pin_change"}).css("margin-left","10px").addClass("change_width_pin marker_anchor").html('<img src="'+chrome.extension.getURL("images/minus.png")+'" alt="Reduce border width by 1px" />').appendTo(r),$("<input />").attr({id:"marker_size_option",type:"text","class":"marker_box_width_select"}).css("width","55px").change(function(){localStorage.setItem("pin_size",$(this).val()+"px"),sendUpdate()}).val(t).appendTo(r));$("<a />").attr({id:"marker_add_pin_change"}).addClass("change_width_pin marker_anchor").html('<img src="'+chrome.extension.getURL("images/plus.png")+'" alt="Increase border width by 1px" />').appendTo(r);$(o).keydown(function(e){38===e.which?$(this).val()<96&&(localStorage.setItem("pin_size",parseInt($(this).val())+1+"px"),$(this).val(parseInt($(this).val())+1)):40===e.which&&$(this).val()>0&&(localStorage.setItem("pin_size",$(this).val()-1+"px"),$(this).val($(this).val()-1))}).bind("mousewheel",function(e){e.preventDefault(),e.originalEvent.wheelDelta/120>0?$(this).val()<96&&(localStorage.setItem("pin_size",parseInt($(this).val())+1+"px"),$(this).val(parseInt($(this).val())+1)):$(this).val()>0&&(localStorage.setItem("pin_size",$(this).val()-1+"px"),$(this).val($(this).val()-1))}),$('<div class="clear-line" />').appendTo(r);$("<input />").attr({id:"marker_flip_option",type:"checkbox","class":"marker_text_size_select"}).css({height:"20px","line-height":"10px","box-shadow":"#ccc 0 1px 6px inset",width:"20px","margin-left":"10px"}).change(function(){$(this).prop("checked")===!0?(localStorage.setItem("rotate_marker","true"),$(".marker_page_marker_"+mCount-1).find("img").addClass("marker_page_marker_rotate"),$(e).find("img").addClass("marker_page_marker_rotate")):(localStorage.setItem("rotate_marker","false"),$(e).find("img").removeClass("marker_page_marker_rotate"))}).appendTo(r),$("<label />").attr({"for":"marker_flip_option","class":"ubuntu marker_options_edit",style:"display: inline; margin-left: 5px;"}).text("Flip horizontally").appendTo(r);$("<a />").text("Options").css({color:"#000","text-decoration":"none"}).click(function(){"none"===$(r).css("display")?("true"===localStorage.getItem("pack_1")?$("#marker-pin-colors-iframe").css("height","490px"):$("#marker-pin-colors-iframe").css("height","375px"),$(r).fadeIn("fast"),$("<span />").addClass("marker_collapse_1").text(" - click to collapse").appendTo($(this))):($(r).css("display","none"),$(this).find(".marker_collapse_1").remove(),"true"===localStorage.getItem("pack_1")?$("#marker-pin-colors-iframe").css("height","390px"):$("#marker-pin-colors-iframe").css("height","275px"))}).appendTo(a),$(r).find(".change_width_pin").click(function(){var e=$(o).val();"marker_sub_pin_change"===$(this).attr("id")?e-=1:e=parseInt(e)+1,$(o).val(e),localStorage.setItem("pin_size",e+"px"),sendUpdate()})}function add_note(){$("#marker_body_wrap, #marker_body_wrap a, #marker_body_wrap button").bind("click",function(e){var t,a=(e.pageX,e.pageY,$(window).width()-25);t=16*localStorage.getItem("font_size").split("p")[0]>a?"500px":16*localStorage.getItem("font_size").split("p")[0],e.pageX+t>a?left="100px":left=e.pageX;var r=$("<div />").resizable({handles:"n, e, s, w, ne, nw, se, sw",containment:"parent",resize:function(){$(r).find("textarea").css("width",$(r).width()-10+"px")},stop:function(){}}).draggable({containment:"parent"}).attr({id:"marker_text_note_"+nCount,"class":"marker_text_note_marker",tabinex:"-1"}).css({left:e.pageX,top:e.pageY,position:"absolute",height:2.8*localStorage.getItem("font_size").split("p")[0],width:t,border:"solid 1px "+localStorage.getItem("font_outline")}).click(function(){$(this).addClass("marker_text_note_marker_selected")}).appendTo("body"),o=localStorage.getItem("text_background"),n=.01*parseInt(localStorage.getItem("text_bg_opacity"));$("<div />").css({opacity:n,"background-color":o,display:"block",width:"100%",height:"100%",border:"solid 1px #"+localStorage.getItem("font_outline")}).addClass("marker_bg_opaque").appendTo(r);var s,i=$("<textarea />").attr({id:"marker_text_note_textarea_"+nCount,tabindex:"-1","class":"marker_text_note_marker_textarea"}).css({color:"#"+localStorage.getItem("font_color"),"font-size":localStorage.getItem("font_size"),"text-shadow":localStorage.getItem("text_shadow_color")+" 1px 1px 2px",width:$(r).width()-10+"px"}).appendTo("#marker_text_note_"+nCount).focus();$(r).hover(function(){s=setTimeout(function(){$(r).find("img").fadeIn("slow"),draw_textbox_options(i,nCount-1)},500)},function(){clearTimeout(s),$(r).find("img").fadeOut("slow"),remove_textbox_options(i,nCount-1)}),$(i).bind("mousewheel",function(e){if(e.preventDefault(),e.originalEvent.wheelDelta/120>0){var t=parseInt($(this).css("font-size").split("p")[0]);t+=1,$(this).css("font-size",t+"px")}else{var t=$(this).css("font-size").split("p")[0];t-=1,$(this).css("font-size",t+"px")}});var l=$("<img />").attr("src",chrome.extension.getURL("images/notes.png")).attr("title","Right click to delete").attr("alt","Note "+nCount).css({position:"absolute",width:"24px",left:"-26px",display:"none"}).bind("contextmenu",function(e){e.preventDefault(),$(r).remove()}).prependTo(r);$(l).hover(function(){return!1}),nCount++,stop_writing_text()})}function draw_text_options(){if($("#marker-box-text-drawer").length>0)$("#marker-box-text-drawer").slideDown("slow");else{var e=$("<div />").attr("id","marker-box-text-drawer").appendTo("#marker-control-panel"),t=document.createElement("INPUT");$(t).attr("type","text"),$(t).attr("id","marker_text_outline_select").attr("style","z-index: 2147483635").addClass("jscolor").val(localStorage.getItem("font_outline"));var a=new jscolor(t),r=document.createElement("INPUT");$(r).attr("type","text"),$(r).attr("id","marker_text_shadow_color").attr("style","z-index: 2147483635").addClass("jscolor").val(localStorage.getItem("text_shadow_color"));var o=new jscolor(r),n=document.createElement("INPUT");$(n).attr("type","text"),$(n).attr("id","marker_text_color").attr("style","z-index: 2147483635").addClass("jscolor").val(localStorage.getItem("font_color"));var s=(new jscolor(n),document.createElement("INPUT"));$(s).attr("type","text"),$(s).attr("id","marker_text_box_bg_color").attr("style","z-index: 2147483635").addClass("jscolor").val(localStorage.getItem("text_background"));var i=new jscolor(s);$("<strong />").addClass("marker").text("Change font size").css("width","97%").appendTo(e);var l=$("<div />").css({margin:"10px"}).appendTo(e),c=($("<a />").attr({id:"marker_sub_text_change"}).addClass("change_width change_font_size marker_anchor").html('<img src="'+chrome.extension.getURL("images/minus.png")+'" alt="Reduce font size by 1px" />').appendTo(l),$("<input />").attr({type:"text",id:"marker_text_font_size_input","class":"marker_box_width_select",value:localStorage.getItem("font_size").split("p")[0]}).bind("mousewheel",function(e){e.preventDefault(),e.originalEvent.wheelDelta/120>0?(localStorage.setItem("font_size",parseInt($(this).val())+1+"px"),$(this).val(parseInt($(this).val())+1)):(localStorage.setItem("font_size",$(this).val()-1+"px"),$(this).val($(this).val()-1)),sendUpdate()}).appendTo(l),$("<a />").attr({id:"marker_add_text_change"}).addClass("change_width change_font_size marker_anchor").html('<img src="'+chrome.extension.getURL("images/plus.png")+'" alt="Increase font-size by 1px" />').appendTo(l),$("<label />").css({"font-weight":"bold","border-bottom":"solid 1px #aaa","margin-bottom":"5px","padding-left":"5px",display:"block"}).attr("for","marker_text_color_select").addClass("marker").text("Text Color").css("width","97%")),d=$("<label />").addClass("marker").css({"font-weight":"bold","border-bottom":"solid 1px #aaa","margin-bottom":"5px","padding-left":"5px",display:"block"}).attr("for","marker_text_outline_select").html("Outline color").css("width","97%"),p=$("<label />").css({"font-weight":"bold","border-bottom":"solid 1px #aaa","margin-bottom":"5px","padding-left":"5px"}).attr("for","marker_text_shadow_color").addClass("marker").text("Text-shadow Color").css("width","97%"),m=$("<label />").css({"font-weight":"bold","border-bottom":"solid 1px #aaa","margin-bottom":"5px","padding-left":"5px"}).attr("for","marker_text_box_bg_color").addClass("marker").text("Background color").css("width","97%");
$(a).ready(function(){var t=$("<div />");$(n).appendTo(t),$(c).prependTo(t),$(t).appendTo(e)}),$(o).ready(function(){var t=$("<div />");$(r).appendTo(t),$(p).prependTo(t),$(t).appendTo(e)}),$(a).ready(function(){var a=$("<div />");$(t).appendTo(a),$(d).prependTo(a),$(a).appendTo(e)}),$("<strong />").addClass("marker").text("Change background opacity").css("width","97%").appendTo(e);var _=$("<div />").css({margin:"10px"}).appendTo(e),g=($("<a />").attr({id:"marker_sub_op_change"}).addClass("change_width change_op marker_anchor").html('<img src="'+chrome.extension.getURL("images/minus.png")+'" alt="Reduce background opacity by .1%" />').appendTo(_),$("<input />").attr({type:"text",id:"marker_text_change_opacity","class":"marker_box_width_select",value:localStorage.getItem("text_bg_opacity").substring(0,3)}).bind("mousewheel",function(e){e.preventDefault();var t=parseFloat($(this).val());e.originalEvent.wheelDelta/120>0?100>t&&(t+=10,localStorage.setItem("text_bg_opacity",t)):t>0&&(t-=10,localStorage.setItem("text_bg_opacity",t)),$(this).val(localStorage.getItem("text_bg_opacity")),sendUpdate()}).appendTo(_));$("<a />").attr({id:"marker_add_op_change"}).addClass("change_width change_op marker_anchor").html('<img src="'+chrome.extension.getURL("images/plus.png")+'" alt="Increase background opacity by .1%" />').appendTo(_);$(i).ready(function(){var t=$("<div />");$(s).appendTo(t),$(m).prependTo(t),$(t).appendTo(e)}),$(".change_font_size").click(function(){var e=$("#marker_text_font_size_input").val();"marker_sub_text_change"===$(this).attr("id")?e-=1:e=parseInt(e)+1,$("#marker_text_font_size_input").val(e),localStorage.setItem("font_size",e+"px"),sendUpdate()}),$(".change_op").click(function(){var e=parseFloat($(g).val());"marker_sub_op_change"===$(this).attr("id")?e>0&&(e-=10):100>e&&(e+=10),$(g).val(e),localStorage.setItem("text_bg_opacity",e),sendUpdate()}),$(r).change(function(e){localStorage.setItem("text_shadow_color","#"+$(r).val()),sendUpdate()}),$(t).change(function(e){localStorage.setItem("font_outline","#"+$(t).val()),sendUpdate()}),$(n).change(function(){localStorage.setItem("font_color","#"+$(n).val()),sendUpdate()}),$(s).change(function(){localStorage.setItem("text_background","#"+$(s).val()),sendUpdate()}),$(".marker_anchor").attr("href","javascript:(0);"),$(e).slideDown("slow")}}function draw_textbox_options(e,t){$(e).offset().left,$(e).offset().top;if($("#marker_note_hover_change_"+t).length>0){$("#marker_text_note_textarea_"+t).offset().top,$("#marker_text_note_textarea_"+t).offset().left;$("#marker_note_hover_change_"+t).fadeIn("fast")}else{var a=$("<div />").attr({id:"marker_note_hover_change_"+t,"class":"marker_note_hover_change_div"}).appendTo("#marker_text_note_"+t);$(a).fadeIn("slow");var r=document.createElement("INPUT");$(r).attr("type","text"),$(r).attr("style","z-index: 2147483635").attr("title","Change text color").addClass("jscolor marker_text_hover_color").val(localStorage.getItem("font_color")),$(r).change(function(e){$(this).css("color","#"+$(this).val()),$(this).parent().parent().find("textarea").css("color","#"+$(this).val())}).appendTo(a);var o=(new jscolor(r),document.createElement("INPUT"));$(o).attr("type","text"),$(o).attr("style","z-index: 2147483635").attr("title","Change shadow color").addClass("jscolor marker_text_hover_color").val(localStorage.getItem("text_shadow_color")),$(o).change(function(e){$(this).css("color","#"+$(this).val()),$(this).parent().parent().find("textarea").css({"text-shadow":"#"+$(this).val()+" 1px 1px 2px"})}).appendTo(a);var n=(new jscolor(o),document.createElement("INPUT"));$(n).attr("type","text"),$(n).attr("style","z-index: 2147483635").attr("title","Change background color").addClass("jscolor marker_text_hover_color").val(localStorage.getItem("text_background")),$(n).change(function(e){$(this).css("color","#"+$(this).val()),$(this).parent().parent().find(".marker_bg_opaque").css({"background-color":"#"+$(this).val()})}).appendTo(a);var s=(new jscolor(n),$("<div />").addClass("marker_text_options_checkboxes").appendTo(a));$("<input />").attr({type:"checkbox",id:"marker_text_options_show_border"+t,"class":"marker-text-checkbox",checked:"true"}).click(function(){var e=$(this).prop("checked");e?$(this).parent().parent().parent().css({border:"solid 1px "+localStorage.getItem("font_outline")}):$(this).parent().parent().parent().css({border:"0"})}).appendTo(s),$("<label />").attr({"for":"marker_text_options_show_border"+t}).text("Show box border").appendTo(s);$("<br />").appendTo(s);$("<input />").attr({type:"checkbox",id:"marker_text_options_show_bg"+t,"class":"marker-text-checkbox",checked:"true"}).click(function(){var e=$(this).prop("checked");e?$(this).parent().parent().parent().find(".marker_bg_opaque").css({"background-color":localStorage.getItem("text_background")}):$(this).parent().parent().parent().find(".marker_bg_opaque").css({background:"none"})}).appendTo(s),$("<label />").attr({"for":"marker_text_options_show_bg"+t}).text("Show box background").appendTo(s)}}function remove_textbox_options(e,t){$("#marker_note_hover_change_"+t).fadeOut("slow")}function stop_writing_text(){$("#marker_body_wrap, #marker_body_wrap a, #marker_body_wrap button").unbind("click"),$("#marker_body_wrap").css("cursor",""),$("#marker_add_text img").attr("src",chrome.extension.getURL("images/add_text_24_inactive.png")),localStorage.setItem("addText","false"),$("#marker-box-text-drawer").slideUp("fast")}function run_marker(e){chrome.runtime.sendMessage({greeting:"start"}),mCount=1,$("body").append('<div id="marker_body_wrap" />'),$("#marker_body_wrap").css({height:$(document).height()+"px",width:$(document).width()+"px","z-index":"2147483629"}),$("<canvas />").attr("id","marker-canvas-element").appendTo("body"),append_scripts_to_head($("head")),window.addEventListener("resize",resize_window),create_marker_panel(),$(".marker_anchor").attr("href","javascript:void(0);"),get_page_json(),display_previous()}function create_marker_panel(){var e=localStorage.getItem("left"),t=localStorage.getItem("top"),a={left:e+"px",top:t+"px",position:"fixed",width:"210px"};parseInt(e)>$(window).width()&&(a.left="50"),parseInt(t)>$(window).height()&&(a.top="50"),parseInt(t)<0&&(a.top="50"),parseInt(e)<0&&(a.left="50");var r=$("<div />").attr({"class":"marker marker-controls",id:"marker-control-panel"}).draggable({containment:"window",stop:function(){$(this).removeClass("annotate-highlight-panel"),$(this).css("position","fixed"),$("#marker-control-panel").css("height","auto"),localStorage.setItem("top",$(this).offset().top),localStorage.setItem("left",$(this).offset().left),sendUpdate()}}).css(a).appendTo("body");"true"===localStorage.getItem("show_tips")&&($(r).addClass("annotate-highlight-panel"),$(r).click(function(){$(r).removeClass("annotate-highlight-panel")}));var o=($("<div />").attr({"class":"marker marker-panel-heading"}).text("Annotate!").appendTo(r),$("<a />").attr({href:"javascript:void(0);",title:"Hide Annotate!","aria-selected":"false","class":"marker_window_resize_anchor"}).appendTo(r));$("<img />").attr({src:chrome.extension.getURL("images/minimize.png"),alt:"Hide Annotate!"}).appendTo(o);$(o).click(function(){$(r).css({top:"auto",right:"0",left:"auto",bottom:"0"})}),$("<a />").attr({id:"marker_draws","class":"marker_option marker_anchor",title:"Highlight an area of page"}).html('<img src="'+chrome.extension.getURL("images/select_24.png")+'" alt="Click to select a section of the page" />').appendTo(r).click(function(e){"false"===localStorage.getItem("draw")?(unplace_marker(),stop_writing_text(),localStorage.setItem("marker_place_flag","false"),$("#place_marker").find("img").attr("src",chrome.extension.getURL("images/pins/pin_24_inactive.png")),$(this).find("img").attr("src",chrome.extension.getURL("images/select_24_active.jpg")),localStorage.setItem("draw","true"),initDraw(document.getElementById("marker_body_wrap")),$("#marker_body_wrap").css("cursor","copy"),"true"===localStorage.getItem("show_tips")&&draw_tips_panel("To draw a box around an area on the page, click once and let the mouse draw the box.  The box is resizable and draggable.  So if you don't get the box in the perfect location, do not fret.  You can adjust it later.  <strong>Do not attempt to draw the box with the left mouse button pressed.  It will not work</strong>"),draw_select_color_options()):(localStorage.setItem("draw","false"),$(this).find("img").attr("src",chrome.extension.getURL("images/select_24.png")),stop_drawing_boxes(document.getElementById("marker_body_wrap")),$("body").removeAttr("style"))}),$("<a />").attr({id:"place_marker","class":"marker_option marker_anchor",title:"Place markers on page"}).html('<img src="'+chrome.extension.getURL("images/pins/pin_24_inactive.png")+'" alt="Click to place marker on page" />').click(function(){"false"==localStorage.getItem("marker_place_flag")?($("#marker_draws").find("img").attr("src",chrome.extension.getURL("images/select_24.png")),$(this).find("img").attr("src",chrome.extension.getURL("images/pins/pin_24_"+localStorage.getItem("flag-color")+".png")),localStorage.setItem("marker_place_flag","true"),localStorage.setItem("draw","false"),stop_writing_text(),stop_drawing_boxes(document.getElementById("marker_body_wrap")),place_marker(),$("#marker_body_wrap").css("cursor","pointer"),draw_new_marker_options(),draw_tips_panel("To place a marker on the screen, simply select the pin you'd like to place and click on the screen.  To edit the pin's note, \"Right click\" on the note.  <strong>Note:</strong> All pins are draggable.  You can reposition them anywhere on the page.<br />")):($(this).find("img").attr("src",chrome.extension.getURL("images/pins/pin_24_inactive.png")),unplace_marker())}).appendTo(r),$("<a />").attr({id:"marker_add_text","class":"marker_option marker_anchor",title:"Add text to screen"}).html('<img src="'+chrome.extension.getURL("images/add_text_24_inactive.png")+'" alt="" />').appendTo(r).click(function(e){var t=localStorage.getItem("addText");"false"===t?(stop_drawing_boxes(document.getElementById("marker_body_wrap")),unplace_marker(),$(this).find("img").attr("src",chrome.extension.getURL("images/add_text_24.png")),localStorage.setItem("addText","true"),localStorage.setItem("draw","false"),$("#marker_body_wrap").css("cursor","text"),$("#marker_draws img").attr("src",chrome.extension.getURL("images/select_24.png")),$("#place_marker img").attr("src",chrome.extension.getURL("images/pins/pin_24_inactive.png")),draw_text_options(),add_note()):(stop_writing_text(),$("#marker_body_wrap").removeAttr("style"))}),$("<a />").attr({id:"marker_saves","class":"marker_option marker_anchor",title:"Save markings"}).html('<img src="'+chrome.extension.getURL("images/save_24.png")+'" alt="Save markings" />').appendTo(r).click(function(e){saveToPdf()}),$("<a />").attr({id:"marker_clear","class":"marker_option marker_anchor",title:"Clear and start over"}).html('<img src="'+chrome.extension.getURL("images/clear.png")+'" alt="Start Over" />').appendTo(r).click(function(e){$(".marker_page_marker, .marker_context_menu, .rectangle, .marker-print-res-cont, #marker_window_resize_msg").remove(),$(mifBody).find(".marker_side_text_selection").remove(),mCount=1}),$(r).fadeIn("fast"),draw_tips_panel("Thanks for using Annotate!  In this area, you'll find tips as you navigate your way through the page<br />")}function saveToPdf(){update_page_json(),$("#marker-results-ifr").remove();var t=$("<div />").attr({id:"marker-print-modal","class":"marker"}).appendTo("body"),a=$("<div />").attr({id:"marker-print-dialog","class":"marker"}).html('Saved!<br />To access your saved annotations, reload the page and follow the screen below:<br /><img src="'+chrome.extension.getURL("images/save.gif")+'" alt="" />').appendTo("body");$("<button />").click(function(){$(t).remove(),$(a).remove();var r=$("#marker_body_wrap"),o=$("<div />").addClass("marker-text-bottom-div").appendTo(r);$(mifBody).find(".marker_side_text_selection").each(function(e,t){$(t).find("h3").clone().appendTo(o),$(t).find(".marker_recommendation").clone().appendTo(o)}),setTimeout(function(){e=jQuery.Event("keydown"),e.which=83,e.ctrlKey=!0,$(this).trigger(e),$(o).remove()},100)}).addClass("marker_fun_btn").css({border:"2px solid #000",color:"#000",width:"98%","font-size":"20px !important","font-weight":"bold"}).text("Got it").appendTo(a)}function draw_tips_panel(e){$(".marker-tips-456").remove();var t=$("<div />");$(t).addClass("marker-tips-456").html(e);$("<input />").attr({type:"checkbox",id:"marker-welcome-tips-chk",style:"width: auto;"}).change(function(){$(this).prop("checked")===!0&&(localStorage.setItem("show_tips","false"),sendUpdate(),$("#marker_window_resize_msg").slideUp("slow"),setTimeout(function(){$("#marker_window_resize_msg").remove()},5e3))}).appendTo(t),$("<label />").attr({"class":"marker_options_edit","for":"marker-welcome-tips-chk",style:"display: inline;"}).text("Don't show tips ever again!").appendTo(t);"true"===localStorage.getItem("show_tips")&&resize_window(!0,t,!0)}function resize_window(e,t,a){var r,o=$(window).width();if($("#marker_body_wrap").css({height:$(document).height()+"px",width:$(document).width()+"px"}),0===$("#marker_window_resize_msg").length){var n=$("<div />").attr({id:"marker_window_resize_msg"}).appendTo("#marker_body_wrap");a?$(n).html(t):$(n).html('<strong>Alert!</strong> <span style="padding: 5px;">Resizing the window does not automatically readjust your markers on the page.  You may need to reposition them.<br /><br />  All markers and moveable and boxes are moveable and resizable.</span>'),$(n).slideDown("slow")}else $("#marker_window_resize_msg").slideDown("fast"),a?$("#marker_window_resize_msg").html(t):$("#marker_window_resize_msg").html('<strong>Alert!</strong> <span style="padding: 5px;">Resizing the window does not automatically readjust your markers on the page.  You may need to reposition them.<br /><br />  All markers and moveable and boxes are moveable and resizable.</span>');r=a?15e3:6e3;var s=localStorage.getItem("marker_window_width"),i=localStorage.getItem("marker_window_height"),o=$(window).width(),l=$(window).height(),c=o-parseInt(s),d=l-parseInt(i);console.log("Width difference: "+c),console.log("Heigh difference: "+d),localStorage.setItem("marker_window_width",$(window).width()),localStorage.setItem("marker_window_height",$(window).height()),setTimeout(function(){$("#marker_window_resize_msg").slideUp("slow")},r)}function sendUpdate(){chrome.runtime.sendMessage({greeting:"store",show_tips:localStorage.getItem("show_tips"),left:localStorage.getItem("left"),top:localStorage.getItem("top"),pin_size:localStorage.getItem("pin_size"),font_size:localStorage.getItem("font_size"),font_color:localStorage.getItem("font_color"),font_outline:localStorage.getItem("font_outline"),text_shadow_color:localStorage.getItem("text_shadow_color"),text_background:localStorage.getItem("text_background"),text_bg_opacity:localStorage.getItem("text_bg_opacity"),text_h_shadow:localStorage.getItem("h_shadow"),text_v_shadow:localStorage.getItem("v_shadow"),text_blur_radius:localStorage.getItem("text_blur_radius"),box_width:localStorage.getItem("box_width"),box_color:localStorage.getItem("box_color"),box_bg_color:localStorage.getItem("box_bg_color"),pageJson:localStorage.getItem("pageJson")})}function stop_marker(){unplace_marker(),$("*").removeClass("marker_body_wrap marker-flagged-issue"),$(".marker-highlight-text").removeAttr("style"),$("#marker-control-panel, .marker_context_menu, .marker_page_marker, .rectangle, #marker_body_wrap").remove(),mCount=0,chrome.runtime.sendMessage({greeting:"stop"})}var mif,mifBody,mCount=1,nCount=1,pageJson=[],issues=[],sess_id="";localStorage.setItem("marker_place_flag","false"),localStorage.setItem("e_c","expanded"),localStorage.setItem("draw","false"),chrome.extension.onRequest.addListener(function(e,t,a){if("start_stop"===e.greeting)if(0==$("#marker-control-panel").length){for(var r in e)localStorage.setItem(r,e[r]);"undefined"===e.flag_color&&localStorage.setItem("flag-color","red"),"[]"===e.preset?get_select_options():localStorage.setItem("preset",e.preset),localStorage.setItem("marker_window_width",$(window).width()),localStorage.setItem("marker_window_height",$(window).height()),run_marker(e.welcome),"true"===e.first&&console.log("first time running Marker after installation")}else stop_marker();else"highlight"===e.greeting&&highlightSelection()});