function append_scripts_to_head(e,t){var a=$("<link />").attr({rel:"stylesheet",type:"text/css",href:chrome.extension.getURL("css/railway.css")}),r=$("<link />").attr({rel:"stylesheet",type:"text/css",href:"https://fonts.googleapis.com/css?family=Ubuntu"}),o=$("<link />").attr({rel:"stylesheet",type:"text/css",href:chrome.extension.getURL("css/marker.css")});e&&$(a,r,o).appendTo(e),t&&($(o).appendTo(t),$(a).appendTo(t),$(r).appendTo(t))}function create_iframe(e,t,a){var r=$("<iframe />").attr({id:e}).appendTo(t);return a&&$(r).addClass(a),r}function get_iframe_bod(e){var t=$("#"+e)[0].contentWindow.document,a=$(t).find("body");return a}function get_iframe_head(e){var t=$("#"+e)[0].contentWindow.document,a=$(t).find("head");return a}function hideMenu(e){$("#"+e).fadeOut("1000")}function showMenu(e,t){$("#"+e).fadeIn("fast"),t&&$("#"+e).find("select").val(t)}function getOptions(){return"a11y"!==localStorage.getItem("set")||localStorage.getItem("preset")?options=$.parseJSON(localStorage.getItem("preset")):$.ajax({url:chrome.extension.getURL("js/types.json"),dataType:"text",type:"GET",async:!1,crossDomain:!1,success:function(e){options=$.parseJSON(e)}}),options}function get_select_options(){$.ajax({url:chrome.extension.getURL("js/types.json"),dataType:"text",type:"GET",async:!1,crossDomain:!1,success:function(e){localStorage.setItem("preset",e)}})}function place_marker(){$("#marker_body_wrap").css("cursor","pointer"),$("#marker_body_wrap, #marker_body_wrap a, #marker_body_wrap button").bind("click",function(e){e.preventDefault(),e.stopPropagation();var t=e.pageX,a=e.pageY;return place_ind_marker(t,a),!1})}function place_ind_marker(e,t,a){var r=$("<a />").addClass("marker_page_marker marker_anchor").attr("data-marker-count",mCount).css({position:"absolute",left:e+"px",top:t+"px"}).bind("contextmenu",function(e){e.preventDefault(),createContextMenu($(this),e,a)}).click(function(e){return"true"===localStorage.getItem("leftclick")&&(createContextMenu($(this),e,a),e.preventDefault()),!1}).appendTo("#marker_body_wrap").draggable({stop:function(){hideMenu("marker_context_menu"+$(this).attr("data-marker-count"))}});$("<img />").attr({src:chrome.extension.getURL("images/pin_24_"+localStorage.getItem("flag-color")+".png"),"class":"marker_page_marker",style:"width: "+localStorage.getItem("pin_size")+";","data-marker-count":mCount}).attr("alt","Marker "+mCount).appendTo(r),"48px"===localStorage.getItem("pin_size")&&$("a.marker_page_marker").css("width","85px"),mCount++}function unplace_marker(){$("#marker_body_wrap, #marker_body_wrap a, #marker_body_wrap button").unbind("click"),$("#marker-pin-colors-drawer").remove(),$("#marker_body_wrap").removeAttr("style")}function draw_new_marker_options(){$("#marker-pin-colors-drawer").remove();var e=$("<div />").attr("id","marker-pin-colors-drawer").appendTo("#marker-control-panel"),t=(create_iframe("marker-pin-colors-iframe",e),get_iframe_bod("marker-pin-colors-iframe")),a=get_iframe_head("marker-pin-colors-iframe");append_scripts_to_head("",a),$("<strong />").addClass("marker").text("Select new pin").appendTo(t);var r=["Red","Pink","Orange","Yellow","Plum","Blue","Aqua","Bluegreen","Green","Lime","Poop","Black","Grey","White","Placeholder_red","Placeholder_blue","Dot_red","Dot_blue","Dot_green","Dot_black"];if($(r).each(function(e,a){$("<a />").attr("data-val",a.toLowerCase()).addClass("marker_option marker_anchor").html('<img src="'+chrome.extension.getURL("images/pin_24_"+a.toLowerCase()+".png")+'" alt="'+a+' marker" />').appendTo(t)}),"true"===localStorage.getItem("icon_pack_1")){var o=["HTML","CSS","Scissors","Notepad","Brackets","Dung","Goldstar","Wrong","Happy","Laughing","Sad","Sick","Heart","Mag","Jason","Freddy"];$(o).each(function(e,a){$("<a />").attr("data-val",a.toLowerCase()).addClass("marker_option marker_anchor").html('<img src="'+chrome.extension.getURL("images/pin_24_"+a.toLowerCase()+".png")+'" alt="'+a+' marker" />').appendTo(t)})}else $("#marker-pin-colors-iframe").css("height","235px");$(t).find(".marker_option img").css("width","24px"),$(t).find(".marker_option img").each(function(e,t){$(t).attr("title",$(t).attr("alt"))}),$(t).find(".marker_option").click(function(){localStorage.setItem("flag-color",$(this).attr("data-val")),$("#place_marker").find("img").css("width","24px").attr("src",chrome.extension.getURL("images/pin_24_"+localStorage.getItem("flag-color")+".png"))}),$(t).find("a.marker_anchor").attr("href","javascript:void(0);")}function initDraw(e){function t(e){var t=e||window.event;t.pageX?(a.x=t.pageX,a.y=t.pageY):t.clientX&&(a.x=t.clientX+document.body.scrollLeft,a.y=t.clientY+document.body.scrollTop)}var a={x:0,y:0,startX:0,startY:0},r=null;"true"===localStorage.getItem("draw")&&(e.onmousemove=function(e){t(e),null!==r&&(r.style.width=Math.abs(a.x-a.startX)+"px",r.style.height=Math.abs(a.y-a.startY)+"px",r.style.left=a.x-a.startX<0?a.x+"px":a.startX+"px",r.style.top=a.y-a.startY<0?a.y+"px":a.startY+"px")},e.onclick=function(t){return null===r?(console.log("begun."),t.preventDefault(),a.startX=a.x,a.startY=a.y,r=document.createElement("div"),r.className="rectangle",r.style.left=a.x+"px",r.style.top=a.y+"px",$(r).css("border-color",localStorage.getItem("box_color")),$(r).css("border-width",localStorage.getItem("box_width")+"px"),""!==localStorage.getItem("box_bg_color")&&$(r).css("background-color",localStorage.getItem("box_bg_color")).css("opacity",".3"),e.appendChild(r),$(r).draggable(),$(r).resizable({handles:"n, e, s, w, ne, nw, se, sw",resize:function(e,t){stop_drawing_boxes(document.getElementById("marker_body_wrap")),$("#place_marker").find("img").attr("src",chrome.extension.getURL("images/pin_24_inactive.png")),localStorage.setItem("marker_place_flag","false"),$("#marker-pin-colors-drawer").remove(),unplace_marker()},stop:function(e,t){initDraw(document.getElementById("marker_body_wrap"))}}),!1):(r=null,console.log("finsihed."),$("#marker_draws").click(),void 0)})}function stop_drawing_boxes(e){e.onmousemove=function(e){},e.onclick=function(e){console.log("Marker [no longer drawing boxes]")}}function draw_select_color_options(){$("#marker-pin-colors-drawer").remove();var e=$("<div />").attr("id","marker-pin-colors-drawer").appendTo("#marker-control-panel");$("<strong />").addClass("marker").text("Change box width").appendTo(e);var t=$("<div />").css({margin:"10px"}).appendTo(e);$("<a />").attr({id:"marker_sub_box_change"}).addClass("change_width marker_anchor").html('<img src="'+chrome.extension.getURL("images/minus.png")+'" alt="Reduce border width by 1px" />').appendTo(t),$("<input />").attr({type:"text",id:"marker_box_width_select",value:localStorage.getItem("box_width")}).appendTo(t),$("<a />").attr({id:"marker_add_box_change"}).addClass("change_width marker_anchor").html('<img src="'+chrome.extension.getURL("images/plus.png")+'" alt="Increase border width by 1px" />').appendTo(t);$("<strong />").addClass("marker").text("Change box color").appendTo(e);var a=document.createElement("INPUT");$(a).attr("type","text"),$(a).attr("id","marker_color_select").attr("style","z-index: 2147483635").addClass("jscolor").val(localStorage.getItem("box_color").substring(1,localStorage.getItem("box_color").length)).appendTo(e);new jscolor(a);$(".change_width").click(function(){var e=$("#marker_box_width_select").val();"marker_sub_box_change"===$(this).attr("id")?e-=1:e=parseInt(e)+1,$("#marker_box_width_select").val(e),localStorage.setItem("box_width",e)}),$("#marker_color_select").change(function(){localStorage.setItem("box_color","#"+$("#marker_color_select").val())}).appendTo(e),$(".marker_anchor").attr("href","javascript:(0);")}function draw_highlight_color_options(){$("#marker-pin-colors-drawer").remove();var e=$("<div />").attr("id","marker-pin-colors-drawer").appendTo("#marker-control-panel");$("<strong />").addClass("marker").text("Change box color").appendTo(e);var t=document.createElement("INPUT");$(t).attr("type","text"),$(t).attr("id","marker_color_select").addClass("jscolor").val(localStorage.getItem("highlight_color").substring(1,localStorage.getItem("highlight_color").length)).appendTo(e);new jscolor(t);$("#marker_color_select").change(function(){localStorage.setItem("highlight_color","#"+$("#marker_color_select").val())}).appendTo(e)}function highlightSelection(){var e=window.getSelection();if(e.rangeCount>0){$("#marker_highlight").find("img").attr("src",chrome.extension.getURL("images/highlight_24.png")),setTimeout(function(){$("#marker_highlight").find("img").attr("src",chrome.extension.getURL("images/highlight_24_inactive.png"))},2e3);var t=e.getRangeAt(0);$(t.commonAncestorContainer).wrap('<span class="marker-highlight-text" style="display:block; background-color: '+localStorage.getItem("highlight_color")+';" />')}else console.log("Marker [Nothing to highlight]")}function check_a11y(){test_anchors(),test_images(),test_html(),issues.length>0?(draw_results(),$("#marker_a11y img").attr("src",chrome.extension.getURL("images/check_24_error.png")),$("#marker_a11y").attr("title","Accessibility Quick Check - "+issues.length+" issues detected!")):($("#marker_a11y img").attr("src",chrome.extension.getURL("images/check_24_pass.png")),$("#marker_a11y").attr("title","Accessibility Quick Check - No issues detected!"))}function draw_results(){var e=$("<div />").attr({"class":"marker marker-a11y-results",id:"marker-a11y-results"}).appendTo("#marker-control-panel");$("#marker-control-panel").css("width","auto"),$("#marker-control-panel").css("height","auto"),$("<a />").attr({id:"marker-panel-close","class":"marker"}).html('<img src="'+chrome.extension.getURL("images/close.png")+'" alt="Close Panel" />').click(function(t){$(e).remove(),$("#marker-control-panel").css("width","164px"),issues=[]}).appendTo(e),$("<div />").attr({"class":"marker marker-panel-heading",id:"marker-a11y-head"}).text("Accessibility Results").appendTo(e);create_iframe("marker-a11y-results-iframe",e,"marker");mifBody=get_iframe_bod("marker-a11y-results-iframe");var t=get_iframe_head("marker-a11y-results-iframe");append_scripts_to_head("",t),$(issues).each(function(e,t){var a=$("<div />").addClass("marker-a11y-res-group").appendTo($(mif).find("body")),r=$("<a />").attr({"class":"marker marker-a11y-top-anchor marker_anchor","aria-expanded":"false"}).appendTo(a).click(function(e){"false"===$(this).attr("aria-expanded")?($(this).parent().find("span").css("display","block"),$(this).attr("aria-expanded","true"),$(this).find(".marker-expanded-ind").text("[ expanded ]")):($(this).parent().find("span").css("display","none"),$(this).attr("aria-expanded","false"),$(this).find(".marker-expanded-ind").text(""))});$("<h3 />").addClass("marker marker-a11y-results-h3").text(t.Issue).appendTo(r),$("<span />").addClass("marker marker-expanded-ind").text("").appendTo(r),$("<span />").addClass("marker marker-a11y-results-span").text(t.Recommendation).appendTo(a),$("<span />").addClass("marker marker-a11y-results-code").text(t.HTML).appendTo(a)})}function test_anchors(e){$("a:visible").each(function(e,t){var a={Issue:"Anchor lacking href attribute",Standard:"WCAG 2.0 AA 1.1",Recommendation:"All anchors must have a valid href attribute and value.  Without this, the anchor is not accessibile via the keyboard.",HTML:t.outerHTML};if(!$(t).attr("href")){issues.push(a),$(t).addClass("marker-flagged-issue");var r=$(t).offset().left,o=$(t).offset().top;place_ind_marker(r,o,"anchor")}})}function test_html(){if(!$("html").attr("lang")){var e={Issue:'No "lang" attribute found on HTML element',Standard:"WCAG 2.0 AA 1.1",Recommendation:"Set the document language to assist screen reader users.",HTML:"<html>"};issues.push(e)}}function test_images(){$("img:visible").each(function(e,t){var a={Issue:"No alt attribute found on image",Standard:"WCAG 2.0 AA 1.1",Recommendation:"All images should have an alt attribute. Images without an alt attribute can cause noise for screen reader users",HTML:t.outerHTML};if(!$(t).is("[alt]")){issues.push(a),$(t).addClass("marker-flagged-issue");var r=$(t).offset().left,o=$(t).offset().top;place_ind_marker(r,o,"imageInfo")}})}function run_marker(e){chrome.runtime.sendMessage({greeting:"start"}),mCount=1,$("body").wrapInner('<div id="marker_body_wrap" />'),$("<canvas />").attr("id","marker-canvas-element").appendTo("body"),append_scripts_to_head("head"),window.addEventListener("resize",resize_window),create_marker_panel(),$(".marker_anchor").attr("href","javascript:void(0);")}function create_marker_panel(){var e=localStorage.getItem("left"),t=localStorage.getItem("top");e>$(window).width()&&(e=$(window).width-100),t>$(window).height()&&(t=$(window).height()-200);var a=$("<div />").attr({"class":"marker marker-controls",id:"marker-control-panel"}).draggable({stop:function(){$(this).css("position","fixed"),$("#marker-control-panel").css("height","auto"),localStorage.setItem("top",$(this).offset().top),localStorage.setItem("left",$(this).offset().left),sendUpdate()}}).css({left:e+"px",top:t+"px",position:"fixed",width:"164px"}).appendTo("body");$("<div />").attr({"class":"marker marker-panel-heading"}).text("Marker!").appendTo(a),$("<a />").attr({id:"marker_draws","class":"marker_option marker_anchor",title:"Highlight an area of page"}).html('<img src="'+chrome.extension.getURL("images/select_24.png")+'" alt="Click to select a section of the page" />').appendTo(a).click(function(e){"false"===localStorage.getItem("draw")?(unplace_marker(),draw_select_color_options(),localStorage.setItem("marker_place_flag","false"),$("#place_marker").find("img").attr("src",chrome.extension.getURL("images/pin_24_inactive.png")),$(this).find("img").attr("src",chrome.extension.getURL("images/select_24_active.jpg")),localStorage.setItem("draw","true"),initDraw(document.getElementById("marker_body_wrap")),$("body").attr("style","cursor: crosshair"),"true"===localStorage.getItem("show_tips")&&draw_tips_panel("To draw a box around an area on the page, click once and let the mouse draw the box.  The box is resizable and draggable.  So if you don't get the box in the perfect location, do not fret.  You can adjust it later.  <strong>Do not attempt to draw the box with the left mouse button pressed.  It will not work</strong>")):($("#marker_body_wrap").css("cursor","default !important;"),localStorage.setItem("draw","false"),$(this).find("img").attr("src",chrome.extension.getURL("images/select_24.png")),stop_drawing_boxes(document.getElementById("marker_body_wrap")),$("body").removeAttr("style"),$("#marker-pin-colors-drawer").remove())}),$("<a />").attr({id:"place_marker","class":"marker_option marker_anchor",title:"Place markers on page"}).html('<img src="'+chrome.extension.getURL("images/pin_24_inactive.png")+'" alt="Click to place marker on page" />').click(function(){"false"==localStorage.getItem("marker_place_flag")?($("#marker_draws").find("img").attr("src",chrome.extension.getURL("images/select_24.png")),$(this).find("img").attr("src",chrome.extension.getURL("images/pin_24_"+localStorage.getItem("flag-color")+".png")),localStorage.setItem("marker_place_flag","true"),localStorage.setItem("draw","false"),place_marker(),draw_new_marker_options(),stop_drawing_boxes(document.getElementById("marker_body_wrap")),draw_tips_panel("To place a marker on the screen, simply select the pin you'd like to place and click on the screen.  To edit the pin's note, \"Right click\" on the note.  <strong>Note:</strong> All pins are draggable.  You can reposition them anywhere on the page.<br />")):($(this).find("img").attr("src",chrome.extension.getURL("images/pin_24_inactive.png")),localStorage.setItem("marker_place_flag","false"),$("#marker-pin-colors-drawer").remove(),unplace_marker())}).appendTo(a),$("<a />").attr({id:"marker_clear","class":"marker_option marker_anchor",title:"Clear and start over"}).html('<img src="'+chrome.extension.getURL("images/clear.png")+'" alt="Start Over" />').appendTo(a).click(function(e){$(".marker_page_marker, .marker_context_menu, .rectangle, .marker-print-res-cont, #marker_window_resize_msg").remove(),$(mifBody).find(".marker_side_text_selection").remove(),mCount=1}),$("<a />").attr({id:"marker_saves","class":"marker_option marker_anchor",title:"Save markings"}).html('<img src="'+chrome.extension.getURL("images/save_24.png")+'" alt="Save markings" />').appendTo(a).click(function(e){saveToPdf()}),$(a).fadeIn("fast")}function createContextMenu(e,t,a){var r,o="marker_context_menu"+$(e).attr("data-marker-count"),n=$(e).css("top"),s=$(window).width();if(0===$("#"+o).length){r=t.pageX+427>s?s-450+"px":t.pageX+35+"px";var i=$("<div />").addClass("marker_context_menu").css({left:r,top:n}).attr("role","dialog").attr("id",o).attr("data-marker-dialog-count",$(e).attr("data-marker-count")).draggable({stop:function(){}}).css("position","absolute").appendTo("body"),l=$("<a />").attr({"class":"marker_context_close",href:"javascript:void(0)"}).html('<span class="screen-reader-only">Close context menu for number'+$(e).attr("data-marker-count")+'</span><img src="'+chrome.extension.getURL("images/close.png")+'" alt="" />').appendTo(i);$(l).click(function(t){hideMenu("marker_context_menu"+$(e).attr("data-marker-count"))}),$("<h2 />").addClass("marker marker_drag").attr("tabindex","-1").text("Add notes").appendTo(i);var c=$("<div />").addClass("marker-context-menu-iframe-container").appendTo(i),m=($("<iframe />").css("display","none").addClass("marker-context-iframe").attr("id","marker-context-menu-"+$(e).attr("data-marker-count")).appendTo(c),$("#marker-context-menu-"+$(e).attr("data-marker-count"))[0].contentWindow.document),d=$(m).find("body");append_scripts_to_head("",$(m).find("head"));var p=$("<div />").addClass("marker marker_info").appendTo(d);if("a11y"===localStorage.getItem("set")||"html"===localStorage.getItem("set"))$("<label />").attr("for","marker_select_box_"+mCount).addClass("marker_required marker_label").text("Type of element?").appendTo(p),add_marker_select_options(p,e,a),$("<label />").attr("for","marker_textarea_"+mCount).addClass("marker_required marker_label").text("Notes").appendTo(p),$("<textarea />").addClass("marker_textarea_notes").attr("id","marker_textarea)"+mCount).appendTo(p),$(".marker-context-menu-iframe-container:visible").css("height","390px");else{$("<label />").attr("for","marker_textarea_"+mCount).addClass("marker_required marker_label").text("Notes").appendTo(p),$("<textarea />").addClass("marker_textarea_notes").attr("id","marker_textarea)"+mCount).appendTo(p);$(p).height();$(".marker-context-menu-iframe-container:visible").css("height","305px"),$(".marker_context_menu:visible").css("height","335px")}$("<button />").addClass("marker marker_fun_btn marker_save_note_btn").attr("value","Save Note").text("Save").click(function(t){hideMenu("marker_context_menu"+$(e).attr("data-marker-count"))}).appendTo(d),$("<button />").addClass("marker marker_fun_btn").attr("value","Delete").text("Delete this flag").click(function(t){$(e).remove(),$(mifBody).find(".marker_side_text_selection").eq($(mifBody).find(".marker_side_text_selection").length-1).remove(),$(i).remove(),mCount--}).appendTo(d),$("#"+o).find("iframe").ready(function(){$("#"+o).find("iframe").fadeIn("fast")})}else showMenu(o,a)}function add_marker_select_options(e,t,a){var r=getOptions(),o=$("<select />").attr("id","marker_select_box_"+mCount).attr("aria-required","true").appendTo(e),n=$("<div />").addClass("marker marker_recommendation").attr("id","marker_select_text_div_"+mCount).appendTo(e),s=$("<a />").addClass("marker-a11y-rec-a marker_anchor").attr("aria-expanded","true").click(function(e){"false"===$(this).attr("aria-expanded")?($(this).parent().find(".marker_recommendation_div").show(),$(this).attr("aria-expanded","true")):($(this).parent().find(".marker_recommendation_div").hide(),$(this).find(".marker-a11y-rec-note").text("[ collapsed ]"),$(this).attr("aria-expanded","false"))}).appendTo(n),i=$("<strong />").addClass("recommendations").text("Recommendation").css("display","none").appendTo(s);$("<span />").addClass("marker-a11y-rec-note").appendTo(i);$(r).each(function(e,t){$("<option />").attr("value",t.Value).attr("data-marker-rec",t.Rec).text(t.QuickName).appendTo(o)}),$(o).change(function(){var t=$(this).val();""===t?$(i).hide():$(this).find("option").each(function(e,a){if(t===$(a).attr("value")){var r=$("<div />").addClass("marker marker_recommendation_div").html($(a).attr("data-marker-rec"));return $(i).show(),$(this).parent(0).parent().parent().find(".marker_ele_type").text($(a).text()),$(this).parent().parent().find(".marker_recommendation_div").remove(),$(this).parent().parent().find(".marker_recommendation").append(r),!1}});var a=$(e).height(),r=a+95;$(".marker-context-menu-iframe-container:visible").css("height",r+"px"),$(".marker_context_menu:visible").css("height",r+"px")});t.nodeName,$(t).text();a&&($(o).val(a),$(o).change())}function saveToPdf(){$("#marker-results-ifr").remove();var t=$("<div />").attr({id:"marker-print-modal","class":"marker"}).appendTo("body"),a=$("<div />").attr({id:"marker-print-dialog","class":"marker"}).html("Thanks for using Marker!  In this initial release, there's no true \"Save\" feature.<br />Please close this dialog and press  <kbd>Ctrl</kbd> + <kbd>S</kbd> to save this as a .html file<br /><br />At the bottom of this page, you'll find all of the recommendations that you've made.").appendTo("body"),r=(create_iframe("marker-results-ifr","body"),get_iframe_bod("marker-results-ifr")),o=get_iframe_head("marker-results-ifr");append_scripts_to_head("",o);var n=$("<div />").addClass("marker-print-res-cont").appendTo(r),s=$("<ol />").addClass("marker-res").appendTo(n);$(".marker_context_menu").each(function(e,t){var a=$(t).find("iframe").attr("id"),r=$("#"+a)[0].contentWindow.document,o=$(r).find("body"),n=$(o).find("select option:selected").text(),i=$("<li />").addClass("marker-a11y-res-list-type").appendTo(s);$('<div class="marker-res-type-issue" />').text(n).appendTo(i);var l=$(o).find(".marker_recommendation_div").html();$('<strong class="recommendations" />').text("Recommendation").appendTo(i),$("<div />").html(l).appendTo(i);var c=$(o).find("textarea").val();""!==c&&$("<div />").html('<strong class="recommendations">User notes</strong><span class="marker_user_note">'+c+"</span></div>").appendTo(i)});$("<button />").click(function(){$(t).remove(),$(a).remove();var r=$("#marker_body_wrap"),o=$("<div />").addClass("marker-text-bottom-div").appendTo(r);$(mifBody).find(".marker_side_text_selection").each(function(e,t){$(t).find("h3").clone().appendTo(o),$(t).find(".marker_recommendation").clone().appendTo(o)}),setTimeout(function(){e=jQuery.Event("keydown"),e.which=83,e.ctrlKey=!0,$(this).trigger(e),$(o).remove()},100)}).addClass("marker_fun_btn").css({border:"2px solid #000",color:"#000",width:"98%","font-size":"20px !important","font-weight":"bold"}).text("Ok!").appendTo(a)}function draw_tips_panel(e){$(".marker-tips-456").remove();var t=$("<div />");$(t).addClass("marker-tips-456").html(e);$("<input />").attr({type:"checkbox",id:"marker-welcome-tips-chk",style:"width: auto;"}).change(function(){$(this).prop("checked")===!0&&(localStorage.setItem("show_tips","false"),sendUpdate(),$("#marker_window_resize_msg").slideUp("slow"),setTimeout(function(){$("#marker_window_resize_msg").remove()},5e3))}).appendTo(t),$("<label />").attr({"class":"marker_options_edit","for":"marker-welcome-tips-chk",style:"display: inline;"}).text("Don't show tips ever again!").appendTo(t);"true"===localStorage.getItem("show_tips")&&resize_window(!0,t,!0)}function resize_window(e,t,a){var r;if(0===$("#marker_window_resize_msg").length){var o=$("<div />").attr({id:"marker_window_resize_msg"}).appendTo("#marker_body_wrap");a?$(o).html(t):$(o).html('<strong>Alert!</strong> <span style="padding: 5px;">Resizing the window does not automatically readjust your markers on the page.  You may need to reposition them.<br /><br />  All markers and moveable and boxes are moveable and resizable.</span>'),$(o).slideDown("slow")}else $("#marker_window_resize_msg").slideDown("fast"),a?$("#marker_window_resize_msg").html(t):$("#marker_window_resize_msg").html('<strong>Alert!</strong> <span style="padding: 5px;">Resizing the window does not automatically readjust your markers on the page.  You may need to reposition them.<br /><br />  All markers and moveable and boxes are moveable and resizable.</span>');r=a?15e3:6e3,setTimeout(function(){$("#marker_window_resize_msg").slideUp("slow")},r)}function sendUpdate(){chrome.runtime.sendMessage({greeting:"store",show_tips:localStorage.getItem("show_tips"),left:localStorage.getItem("left"),top:localStorage.getItem("top")})}function stop_marker(){console.log("stop marker!"),$("*").removeClass("marker_body_wrap marker-flagged-issue marker-highlight-text"),$("#marker-control-panel, .marker_context_menu, .marker_page_marker, .rectangle").remove(),mCount=0,chrome.runtime.sendMessage({greeting:"stop"})}var mif,mifBody,mCount=1,issues=[];localStorage.setItem("marker_place_flag","false"),localStorage.setItem("e_c","expanded"),localStorage.setItem("draw","false"),chrome.extension.onRequest.addListener(function(e,t,a){"start_stop"===e.greeting?0==$("#marker-control-panel").length?(localStorage.setItem("left",e.left),localStorage.setItem("top",e.top),localStorage.setItem("set",e.set),localStorage.setItem("box_color",e.box_color),localStorage.setItem("marker-font-size",e.marker_font_size),localStorage.setItem("flag-color",e.flag_color),localStorage.setItem("box_width",e.box_width),localStorage.setItem("first_time",e.first),localStorage.setItem("icon_pack_1",e.icon_pack_1),localStorage.setItem("highlight_color",e.highlight_color),localStorage.setItem("box_bg_color",e.box_bg_color),localStorage.setItem("pin_size",e.pin_size),localStorage.setItem("show_tips",e.show_tips),"undefined"===e.flag_color&&localStorage.setItem("flag-color","red"),"[]"===e.preset?get_select_options():localStorage.setItem("preset",e.preset),run_marker(e.welcome),"true"===e.first&&console.log("first time running Marker after installation")):stop_marker():"highlight"===e.greeting&&highlightSelection()});